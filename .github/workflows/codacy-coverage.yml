name: Test & Codacy Coverage

on:
    push:
        branches: [main]
    pull_request:

jobs:
    test:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4

            - name: Setup Node
              uses: actions/setup-node@49933ea5288caeca8642d1e84afbd3f7d6820020 # v4
              with:
                  node-version: 20
                  cache: npm

            - name: Install
              run: npm ci

            - name: Lint
              run: npm run lint

            - name: Test with coverage
              run: npm run coverage

            - name: Upload coverage to Codacy
              uses: codacy/codacy-coverage-reporter-action@89d6c85cfafaec52c72b6c5e8b2878d33104c699 # v1
              with:
                  project-token: ${{ secrets.CODACY_PROJECT_TOKEN }}
                  coverage-reports: coverage/lcov.info
                  # Optional: specify branch explicitly if needed
                  # commit-uuid: ${{ github.sha }}
